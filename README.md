# π® κµ¬λ§¤ ν¨ν„΄ λ¶„μ„ API

μ•„μ΄λ“¤μ κµ¬λ§¤ μµκ΄€κ³Ό μ†λΉ„ ν¨ν„΄μ„ λ¶„μ„ν•λ” λ°±μ—”λ“ API μ„λ²„μ…λ‹λ‹¤.

## β¨ μ£Όμ” κΈ°λ¥

### π“ API κΈ°λ¥
- **μ£Όκ°„ λ©”νΈλ¦­**: μ΄ μ†λΉ„μ•΅, μ „μ£Ό λ€λΉ„ λ³€ν™”μ¨, μΈκΈ° μΉ΄ν…κ³ λ¦¬, κµμ΅ λΉ„μ¤‘
- **μΌλ³„ νΈλ λ“**: μ£Όκ°„ μΉ΄ν…κ³ λ¦¬λ³„ μ†λΉ„ ν¨ν„΄ λ°μ΄ν„°
- **μΉ΄ν…κ³ λ¦¬ λ¶„ν¬**: κ°„μ‹, μ¤λ½, μ¥λ‚κ°, κµμ΅, κΈ°νƒ€λ³„ μ§€μ¶ λ¶„ν¬
- **μ‹κ°„λ€ ν¨ν„΄**: 24μ‹κ°„ κµ¬λ§¤ μ‹κ°„λ€λ³„ ν–‰λ™ λ¶„μ„
- **μΈκΈ° μƒν’**: κ°€μ¥ λ§μ΄ κµ¬λ§¤ν•λ” μƒν’ λ­ν‚Ή (Top 8)
- **μ¤λ§νΈ μ•λ¦Ό**: μ†λΉ„ ν¨ν„΄ κΈ°λ° κ°μΈν™”λ μ¶”μ² λ° κ²½κ³ 
- **ν•κµ­ μ‹κ°„ μ§€μ›**: λ¨λ“  νƒ€μ„μ¤νƒ¬ν”„κ°€ KST(UTC+9) κΈ°μ¤€μΌλ΅ μ²λ¦¬

### π›  κΈ°μ  μ¤νƒ
- **Backend**: FastAPI + MongoDB + Pandas
- **Database**: MongoDB
- **Package Management**: UV (Python)
- **Timezone**: pytz (ν•κµ­ μ‹κ°„ μ§€μ›)

## π€ λΉ λ¥Έ μ‹μ‘

### μ „μ  μ΅°κ±΄
- Python 3.9+
- MongoDB μ‹¤ν–‰ μ¤‘
- UV (Python package manager)

### 1. μ €μ¥μ† ν΄λ΅  λ° μ„¤μ •
```bash
git clone <repository-url>
cd purchase_dashboard

# Python ν™κ²½ μ„¤μ •
uv sync
```

### 2. ν™κ²½ λ³€μ μ„¤μ •
`.env.example` νμΌμ„ `.env`λ΅ λ³µμ‚¬ν•κ³  MongoDB μ„¤μ •:

```bash
cp .env.example .env
```

`.env` νμΌ λ‚΄μ©:
```env
MONGO_URI=mongodb://localhost:27017/
MONGO_DB_NAME=finance_app
COLLECTION_NAME=purchase_history
```

### 3. μ„λ²„ μ‹¤ν–‰

```bash
# UV ν™κ²½μ—μ„ μ‹¤ν–‰
uv run uvicorn app.main:app --reload --port 8001
```

### 4. μ ‘μ† ν™•μΈ
- **API λ¬Έμ„**: http://localhost:8001/docs
- **Health Check**: http://localhost:8001/health

## π“΅ API μ—”λ“ν¬μΈνΈ

### λ€μ‹λ³΄λ“ λ°μ΄ν„°
```
GET /api/dashboard/{child_id}?days={days}
```
- **νλΌλ―Έν„°**: 
  - `child_id`: μ•„μ΄ μ‹λ³„μ
  - `days`: λ¶„μ„ κΈ°κ°„ (κΈ°λ³Έκ°’: 7μΌ)
- **μ‘λ‹µ**: μ£Όκ°„ λ©”νΈλ¦­, νΈλ λ“, λ¶„ν¬, ν¨ν„΄, μΈκΈ°μƒν’, μ•λ¦Ό λ°μ΄ν„°
- **νƒ€μ„μ¤νƒ¬ν”„**: λ¨λ“  μ‹κ°„ λ°μ΄ν„°λ” ν•κµ­ μ‹κ°„(KST) κΈ°μ¤€

### μ•„μ΄ λ©λ΅ μ΅°ν
```
GET /api/children
```
- **μ‘λ‹µ**: μ‹μ¤ν…μ— λ“±λ΅λ λ¨λ“  μ•„μ΄ λ©λ΅

### μ‹μ¤ν… μƒνƒ
```
GET /health
GET /api/health
```
- **μ‘λ‹µ**: μ„λ²„ λ° λ°μ΄ν„°λ² μ΄μ¤ μ—°κ²° μƒνƒ (ν•κµ­ μ‹κ°„ ν¬ν•¨)

## π“ ν”„λ΅μ νΈ κµ¬μ΅°

```
purchase_dashboard/
β”β”€β”€ app/                    # λ°±μ—”λ“ μ• ν”λ¦¬μΌ€μ΄μ…
β”‚   β”β”€β”€ main.py            # FastAPI μ•± μ—”νΈλ¦¬ν¬μΈνΈ
β”‚   β”β”€β”€ database.py        # MongoDB μ—°κ²° κ΄€λ¦¬
β”‚   β”β”€β”€ models.py          # λ°μ΄ν„° λ¨λΈ μ •μ
β”‚   β”β”€β”€ analytics.py       # λ°μ΄ν„° λ¶„μ„ λ΅μ§
β”‚   β”β”€β”€ utils.py           # ν•κµ­ μ‹κ°„ μ ν‹Έλ¦¬ν‹° ν•¨μ
β”‚   β””β”€β”€ api/
β”‚       β””β”€β”€ analytics.py   # API μ—”λ“ν¬μΈνΈ
β”β”€β”€ pyproject.toml         # Python ν”„λ΅μ νΈ μ„¤μ •
β”β”€β”€ requirements.txt       # Python μμ΅΄μ„± (νΈν™μ„±)
β”β”€β”€ uv.lock               # UV μμ΅΄μ„± μ κΈ νμΌ
β””β”€β”€ .env                   # ν™κ²½ λ³€μ μ„¤μ •
```

## π—ƒ λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§

MongoDB μ»¬λ ‰μ… κµ¬μ΅°:
```javascript
{
  _id: ObjectId,
  childId: String,        // μ•„μ΄ μ‹λ³„μ
  name: String,           // μƒν’λ…
  price: Number,          // κ°λ³„ κ°€κ²©
  cnt: Number,            // κµ¬λ§¤ κ°μ
  timestamp: Date,        // κµ¬λ§¤ μ‹κ°„ (UTC μ €μ¥, APIμ—μ„ KST λ³€ν™)
  label: String,          // μΉ΄ν…κ³ λ¦¬ (SNACK, ENTERTAINMENT, TOY, EDUCATION, ETC)
  productId: String       // μƒν’ μ‹λ³„μ
}
```

### π“… μ‹κ°„λ€ μ²λ¦¬
- **λ°μ΄ν„°λ² μ΄μ¤**: UTC μ‹κ°„μΌλ΅ μ €μ¥
- **API μ‘λ‹µ**: ν•κµ­ μ‹κ°„(KST, UTC+9)μΌλ΅ λ³€ν™
- **λ¶„μ„ κΈ°μ¤€**: ν•κµ­ μ‹κ°„ κΈ°μ¤€μΌλ΅ μΌλ³„/μ‹κ°„λ³„ ν¨ν„΄ κ³„μ‚°

## π― μΉ΄ν…κ³ λ¦¬ λ§¤ν•‘

| μ›λ³Έ λΌλ²¨ | ν•κµ­μ–΄ μΉ΄ν…κ³ λ¦¬ | μ„¤λ… |
|-----------|-----------------|------|
| SNACK | κ°„μ‹ | κ³Όμ, μ‚¬νƒ• λ“± |
| ENTERTAINMENT | μ¤λ½ | κ²μ„, μμƒ μ‹μ²­ λ“± |
| TOY | μ¥λ‚κ° | λ κ³ , μΈν• λ“± |
| EDUCATION | κµμ΅ λ° λ¬Έκµ¬ | λ„μ„, ν•™μµ λ„κµ¬ λ“± |
| FOOD | λ¨Ήμ΄ | κ²μ„ μΊλ¦­ν„° λ¨Ήμ΄ |
| ETC | κΈ°νƒ€ | κΈ°νƒ€ λ¨λ“  ν•­λ© |

## π”§ κ°λ° μ°Έκ³ μ‚¬ν•­

### μ½”λ“ μ¤νƒ€μΌ
- Python: FastAPI κ¶μ¥ μ¤νƒ€μΌ
- API μ„¤κ³„: RESTful μ›μΉ™ μ¤€μ

### μ£Όμ” λΌμ΄λΈλ¬λ¦¬
- **λ¶„μ„**: pandas, numpy
- **μ›Ή ν”„λ μ„μ›ν¬**: FastAPI
- **λ°μ΄ν„°λ² μ΄μ¤**: pymongo, motor
- **μ‹κ°„λ€**: pytz (ν•κµ­ μ‹κ°„ KST μ§€μ›)

### ν™κ²½λ³„ μ„¤μ •
- **κ°λ°**: λ΅μ»¬ MongoDB, Hot reload ν™μ„±ν™”
- **ν”„λ΅λ•μ…**: ν™κ²½λ³€μλ΅ MongoDB URI μ„¤μ •
- **μ‹κ°„λ€**: λ¨λ“  νƒ€μ„μ¤νƒ¬ν”„λ” ν•κµ­ μ‹κ°„(KST, UTC+9) κΈ°μ¤€

### π•’ μ‹κ°„ μ²λ¦¬ νΉμ§•
- **μΌκ΄€μ„±**: λ¨λ“  API μ‘λ‹µμ—μ„ ν†µμΌλ ν•κµ­ μ‹κ°„ μ κ³µ
- **μ •ν™•μ„±**: μ‚¬μ©μ μ‹κ°„λ€μ— λ§λ” μ •ν™•ν• λ¶„μ„ κ²°κ³Ό
- **νΈν™μ„±**: ISO 8601 ν•μ‹ + νƒ€μ„μ΅΄ μ¤ν”„μ…‹ (`+09:00`) μ§€μ›

## π“‹ API μ‘λ‹µ μμ‹

### Health Check μ‘λ‹µ
```json
{
  "status": "healthy",
  "database": "MongoDB μ—°κ²° μ •μƒ (μ΄ 405κ±΄μ λ°μ΄ν„°)",
  "timestamp": "2025-06-25T14:06:36.418737+09:00"
}
```

### λ€μ‹λ³΄λ“ μ‘λ‹µ (μΌλ¶€)
```json
{
  "metrics": {
    "thisWeekTotal": 15000,
    "weeklyChange": 12.5,
    "mostPopularCategory": "κ°„μ‹",
    "educationRatio": 25.0
  },
  "lastUpdated": "2025-06-25T14:06:42.975744+09:00"
}
```

## π“ λ³€κ²½ λ΅κ·Έ

### v1.1.0 (2025-06-25)
- β¨ **ν•κµ­ μ‹κ°„ μ§€μ›**: λ¨λ“  νƒ€μ„μ¤νƒ¬ν”„κ°€ KST(UTC+9) κΈ°μ¤€μΌλ΅ λ³€κ²½
- π”§ **μƒλ΅μ΄ μ ν‹Έλ¦¬ν‹°**: `app/utils.py` ν•κµ­ μ‹κ°„ λ³€ν™ ν•¨μ μ¶”κ°€
- π“ **μ •ν™•ν• λ¶„μ„**: ν•κµ­ μ‹κ°„ κΈ°μ¤€μΌλ΅ μΌλ³„/μ‹κ°„λ³„ ν¨ν„΄ λ¶„μ„
- π **API κ°μ„ **: μ•„μ΄ λ©λ΅ μ΅°ν μ—”λ“ν¬μΈνΈ μ¶”κ°€
- π› **λ²„κ·Έ μμ •**: κµμ΅ μΉ΄ν…κ³ λ¦¬ λΌλ²¨ ν†µμΌ ('κµμ΅ λ° λ¬Έκµ¬')

### v1.0.0 (2025-06-XX)
- π‰ **μ΄κΈ° λ¦΄λ¦¬μ¤**: κµ¬λ§¤ ν¨ν„΄ λ¶„μ„ API κΈ°λ³Έ κΈ°λ¥ κµ¬ν„
